#!/bin/bash
# Shim: runs bit as git for the git test suite.
# Creates .git directory junctions via BIT_GIT_JUNCTION so git's repo
# discovery works (tests expect a standard .git layout).

# Set BIT_REAL_GIT so bit's internal git calls don't recurse through this shim.
# Find the real git by temporarily removing our directory from PATH.
if [ -z "$BIT_REAL_GIT" ]; then
    shim_dir="$(cd "$(dirname "$0")" && pwd)"
    clean_path=$(echo "$PATH" | tr ':' '\n' | grep -v "^${shim_dir}$" | tr '\n' ':' | sed 's/:$//')
    BIT_REAL_GIT=$(PATH="$clean_path" command -v git)
    export BIT_REAL_GIT
fi

export BIT_GIT_JUNCTION=1
exec bit "$@"
