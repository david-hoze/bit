# Test .bitignore support

# Setup: fresh repo with .bitignore
rmdir /s /q test\cli\output\work_bitignore 2>nul & mkdir test\cli\output\work_bitignore & cd test\cli\output\work_bitignore & bit init
<<<
>>> /.*[Ii]nitialized.*/
>>>= 0

# Create .bitignore with *.log pattern
cd test\cli\output\work_bitignore && echo *.log> .bitignore
<<<
>>>= 0

# Create test files: file.txt and debug.log
cd test\cli\output\work_bitignore && echo hello> file.txt & echo debug content> debug.log
<<<
>>>= 0

# Add all files - should only stage file.txt
cd test\cli\output\work_bitignore && bit add .
<<<
>>>= 0

# Status should show file.txt as staged
cd test\cli\output\work_bitignore && bit status
<<<
>>> /file\.txt/
>>>= 0

# Verify debug.log is NOT shown in status (use findstr exit code - fail if found)
cd test\cli\output\work_bitignore && bit status | findstr "debug.log" && exit 1 || exit 0
<<<
>>>= 0

# Commit
cd test\cli\output\work_bitignore && bit commit -m "test commit"
<<<
>>> /file.*changed/
>>>= 0

# Check that debug.log metadata file does not exist (exit 0 if missing, exit 1 if exists)
if exist "test\cli\output\work_bitignore\.bit\index\debug.log" (exit 1) else (exit 0)
<<<
>>>= 0

# Check that file.txt metadata DOES exist
if exist "test\cli\output\work_bitignore\.bit\index\file.txt" (exit 0) else (exit 1)
<<<
>>>= 0

# Modify .bitignore to also ignore *.tmp
cd test\cli\output\work_bitignore && echo *.tmp>> .bitignore
<<<
>>>= 0

# Create test.tmp file
cd test\cli\output\work_bitignore && echo temp content> test.tmp
<<<
>>>= 0

# Add all - test.tmp should be ignored
cd test\cli\output\work_bitignore && bit add .
<<<
>>>= 0

# Verify test.tmp is NOT shown in status
cd test\cli\output\work_bitignore && bit status | findstr "test.tmp" && exit 1 || exit 0
<<<
>>>= 0

# Cleanup
rmdir /s /q test\cli\output\work_bitignore 2>nul
<<<
>>>= 0
