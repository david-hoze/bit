# Device name prompt integration tests
# Tests the interactive path when BIT_USE_STDIN=1 (piped input for testing)
# Uses subst on Windows to create a writable volume root for .bit-store

# --- Setup: subst creates Z: -> test/cli so we can write .bit-store at volume root ---
subst Z: %CD%\test\cli 2>nul
<<<
>>>
>>>= 0

# --- Setup: create work dir, remote dir, init bit ---
rmdir /s /q test\cli\work 2>nul & rmdir /s /q test\cli\device_prompt_remote 2>nul & mkdir test\cli\work & mkdir test\cli\device_prompt_remote & cd test\cli\work & bit init
<<<
>>> /Initialized/
>>>= 0

# --- Add remote with piped device name (BIT_USE_STDIN=1) ---
cd test\cli\work & set BIT_USE_STDIN=1 & echo test_device| bit remote add origin Z:\device_prompt_remote
<<<
>>> /Remote.*test_device|Remote.*added/
>>>= 0

# --- Verify remote was stored: either device (test_device) or fallback (local:) ---
findstr /C:"test_device" test\cli\work\.bit\remotes\origin >nul || findstr /C:"local:" test\cli\work\.bit\remotes\origin >nul
<<<
>>>
>>>= 0

# --- Cleanup ---
subst Z: /D 2>nul & rmdir /s /q test\cli\work 2>nul & rmdir /s /q test\cli\device_prompt_remote 2>nul
<<<
>>>
>>>= 0
