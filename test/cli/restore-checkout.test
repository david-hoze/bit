# Test restore and checkout commands (git-compatible syntax)
# Setup: fresh repo with committed file
rmdir /s /q test\cli\output\work_restore 2>nul & mkdir test\cli\output\work_restore & cd test\cli\output\work_restore & bit init
<<<
>>> /.*[Ii]nitialized.*/
>>>= 0

cd test\cli\output\work_restore && echo original> file.txt & bit add file.txt & bit commit -m "Add file"
<<<
>>> /\[master|main|files? changed/
>>>= 0

# Modify file, then restore (discard working tree changes)
cd test\cli\output\work_restore && echo modified> file.txt
<<<
>>>
>>>= 0

cd test\cli\output\work_restore && bit restore file.txt
<<<
>>>
>>>= 0

findstr /C:"original" test\cli\output\work_restore\file.txt >nul
<<<
>>>
>>>= 0

# Modify again, use restore -- (explicit pathspec separator, like git)
cd test\cli\output\work_restore && echo changed> file.txt & bit restore -- file.txt
<<<
>>>
>>>= 0

findstr /C:"original" test\cli\output\work_restore\file.txt >nul
<<<
>>>
>>>= 0

# Modify, then checkout -- (legacy git syntax)
cd test\cli\output\work_restore && echo discarded> file.txt & bit checkout -- file.txt
<<<
>>>
>>>= 0

findstr /C:"original" test\cli\output\work_restore\file.txt >nul
<<<
>>>
>>>= 0

# Test restore --staged (unstage without discarding working tree)
cd test\cli\output\work_restore && echo staged change> file.txt & bit add file.txt
<<<
>>>
>>>= 0

cd test\cli\output\work_restore && bit restore --staged file.txt
<<<
>>>
>>>= 0

cd test\cli\output\work_restore && bit status
<<<
>>> /modified:.*file\.txt/
>>>= 0

findstr /C:"staged change" test\cli\output\work_restore\file.txt >nul
<<<
>>>
>>>= 0

# Restore working tree (discard the modification)
cd test\cli\output\work_restore && bit restore file.txt
<<<
>>>
>>>= 0

findstr /C:"original" test\cli\output\work_restore\file.txt >nul
<<<
>>>
>>>= 0

cd test\cli\output\work_restore && bit status
<<<
>>> /nothing to commit|working tree clean/
>>>= 0

# Test restore . (all files)
cd test\cli\output\work_restore && echo a> a.txt & echo b> b.txt & bit add . & bit commit -m "Add a and b"
<<<
>>> /\[master|main|files? changed/
>>>= 0

cd test\cli\output\work_restore && echo x> a.txt & echo y> b.txt & bit restore .
<<<
>>>
>>>= 0

findstr /C:"a" test\cli\output\work_restore\a.txt >nul
<<<
>>>
>>>= 0

findstr /C:"b" test\cli\output\work_restore\b.txt >nul
<<<
>>>
>>>= 0

# Test checkout -- with multiple paths
cd test\cli\output\work_restore && echo XX> a.txt & echo YY> b.txt & bit checkout -- a.txt b.txt
<<<
>>>
>>>= 0

findstr /C:"a" test\cli\output\work_restore\a.txt >nul
<<<
>>>
>>>= 0

findstr /C:"b" test\cli\output\work_restore\b.txt >nul
<<<
>>>
>>>= 0
